name: "k8s-ruleset"
description: "Ruleset to detect deprecated k8s API versions"
labels:
  - "k8stargetV=v1.24"
rules:
  - message: Deprecated Kubernetes API version 'extensions/v1beta1' is used for 'Deployment'. Consider using 'apps/v1'.
    ruleID: k8s-deprecated-api-001
    description: "Check for usage of deprecated Kubernetes API versions"
    labels:
      - "deprecated-in=v1.9.0"
      - "removed-in=v1.16.0"
    category: potential
    effort: 2
    when:
      and:
      - builtin.yaml:
          key: "$.apiVersion"
          value: "extensions/v1beta1"
          deprecated-in: "v1.9.0"
      - builtin.yaml:
          key: "$.kind"
          value: "Deployment"
          deprecated-in: "v1.9.0"
  - message: Deprecated Kubernetes API version 'apps/v1beta2' is used for 'Deployment'. Consider using 'apps/v1'.
    ruleID: k8s-deprecated-api-002
    description: "Check for usage of deprecated Kubernetes API versions"
    labels:
      - "deprecated-in=v1.9.0"
      - "removed-in=v1.16.0"
    category: potential
    effort: 2
    when:
      and:
      - builtin.yaml:
          key: "$.apiVersion"
          value: "apps/v1beta2"
      - builtin.yaml:
          key: "$.kind"
          value: "Deployment"
  - message: Deprecated Kubernetes API version 'apps/v1beta1' is used for 'Deployment'. Consider using 'apps/v1'.
    ruleID: k8s-deprecated-api-003
    description: "Check for usage of deprecated Kubernetes API versions"
    labels:
      - "deprecated-in=v1.9.0"
      - "removed-in=v1.16.0"
    category: potential
    effort: 2
    when:
      yaml.referenced:
        apiVersion: "apps/v1beta1"
        kind: "Deployment"
  - message: Deprecated Kubernetes API version 'apps/v1beta1' is used for 'StatefulSet'. Consider using 'apps/v1'.
    ruleID: k8s-deprecated-api-004
    description: "Check for usage of deprecated Kubernetes API versions"
    labels:
      - "deprecated-in=v1.9.0"
      - "removed-in=v1.16.0"
    category: potential
    effort: 2
    when:
      and:
      - yaml.referenced:
          key: ".apiVersion"
          value: "apps/v1beta1"
      - yaml.referenced:
          key: ".kind"
          value: "StatefulSet"
  - message: Deprecated Kubernetes API version 'apps/v1beta1' is used for 'StatefulSet'. Consider using 'apps/v1'.
    ruleID: k8s-deprecated-api-004
    description: "Check for usage of deprecated Kubernetes API versions"
    labels:
      - "deprecated-in=v1.9.0"
      - "removed-in=v1.16.0"
    category: potential
    effort: 2
    when:
      and:
      - yaml.k8sResourceMatched:
          apiVersion: "apps/v1beta1"
          kind: "StatefulSet"
          deprecatedIn: "v1.9.0"
          removedIn: "v1.16.0"
  - message: Deprecated Kubernetes API version 'extensions/v1beta1' is used for 'NetworkPolicy'. Consider using 'networking.k8s.io/v1'.
    ruleID: k8s-deprecated-api-005
    description: "Check for usage of deprecated Kubernetes API versions"
    labels:
      - "deprecated-in=v1.9.0"
      - "removed-in=v1.16.0"
    category: potential
    effort: 2
    when:
      and:
      - yaml.referenced:
          path: $.apiVersion
          value: "extensions/v1beta1"
      - yaml.referenced:
          path: $.kind
          value: "NetworkPolicy"
  - message: Deprecated Kubernetes API version 'extensions/v1beta1' is used for 'Ingress'. Consider using 'networking.k8s.io/v1'.
    ruleID: k8s-deprecated-api-006
    description: "Check for usage of deprecated Kubernetes API versions"
    labels:
      - "deprecated-in=v1.14.0"
      - "removed-in=v1.22.0"
    category: potential
    effort: 2
    when:
      and:
      - yaml.referenced:
          path: $.apiVersion
          value: "extensions/v1beta1"
      - yaml.referenced:
          path: $.kind
          value: "Ingress"
  - message: Deprecated Kubernetes API version 'networking.k8s.io/v1beta1' is used for 'Ingress'. Consider using 'networking.k8s.io/v1'.
    ruleID: k8s-deprecated-api-007
    description: "Check for usage of deprecated Kubernetes API versions"
    labels:
      - "deprecated-in=v1.19.0"
      - "removed-in=v1.22.0"
    category: potential
    effort: 2
    when:
      and:
      - yaml.referenced:
          path: $.apiVersion
          value: "networking.k8s.io/v1beta1"
      - yaml.referenced:
          path: $.kind
          value: "Ingress"
  - message: Deprecated Kubernetes API version 'apps/v1beta2' is used for 'ReplicaSet'. Consider using 'apps/v1'.
    ruleID: k8s-deprecated-api-008
    description: "Check for usage of deprecated Kubernetes API versions"
    labels:
      - "deprecated-in="
      - "removed-in=v1.16.0"
    category: potential
    effort: 2
    when:
      and:
      - yaml.referenced:
          path: $.apiVersion
          value: "apps/v1beta2"
      - yaml.referenced:
          path: $.kind
          value: "ReplicaSet"
  - message: Deprecated Kubernetes API version 'apps/v1beta1' is used for 'ReplicaSet'. Consider using 'apps/v1'.
    ruleID: k8s-deprecated-api-009
    description: "Check for usage of deprecated Kubernetes API versions"
    labels:
      - "deprecated-in="
      - "removed-in=v1.16.0"
    category: potential
    effort: 2
    when:
      and:
      - yaml.referenced:
          path: $.apiVersion
          value: "apps/v1beta1"
      - yaml.referenced:
          path: $.kind
          value: "ReplicaSet"
  - message: Deprecated Kubernetes API version 'scheduling.k8s.io/v1beta1' is used for 'PriorityClass'. Consider using 'scheduling.k8s.io/v1'.
    ruleID: k8s-deprecated-api-010
    description: "Check for usage of deprecated Kubernetes API versions"
    labels:
      - "deprecated-in=v1.14.0"
      - "removed-in=v1.22.0"
    category: potential
    effort: 2
    when:
      and:
      - yaml.referenced:
          path: $.apiVersion
          value: "scheduling.k8s.io/v1beta1"
      - yaml.referenced:
          path: $.kind
          value: "PriorityClass"
  - message: Deprecated Kubernetes API version 'apiextensions.k8s.io/v1beta1' is used for 'CustomResourceDefinition'. Consider using 'apiextensions.k8s.io/v1'.
    ruleID: k8s-deprecated-api-011
    description: "Check for usage of deprecated Kubernetes API versions"
    labels:
      - "deprecated-in=v1.16.0"
      - "removed-in=v1.22.0"
    category: potential
    effort: 2
    when:
      and:
      - yaml.referenced:
          path: $.apiVersion
          value: "apiextensions.k8s.io/v1beta1"
      - yaml.referenced:
          path: $.kind
          value: "CustomResourceDefinition"
